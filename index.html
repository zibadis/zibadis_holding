<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Merge Features | Laboratory</title>
  <!-- لود سه‌جی‌اس -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.145/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145/examples/js/controls/OrbitControls.js"></script>
  <!-- لود GLTFLoader از examples/js (نه jsm) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
     
    /* fontsize end */


    /* Disable horizontal scroll but allow vertical */
 

/* Ensure #infoModal and other sections do not overflow */
 

/* Make sure the main container scrolls properly */
 
/* size */
 

 
/* size */
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #ffffff;
      overflow: hidden;
      font-family: 'YekanBakh';
    }
    body {
  font-size: 100%;
}

h1 {
  font-size: 2.5em;
}

h2 {
  font-size: 1.875em;
}

p {
  font-size: 0.875em;
}
    #infoModal {
      position: fixed;
      top: 50%;
      left: 50%;
      flex-flow: column wrap;
      transform: translate(-50%, -50%) scale(0.7);
      /* عرض و ارتفاع 80% ویوپورت (یا هر چیزی که مدنظر است) */
      width: 80vw;
      height: 80vh;
      /* فاصله داخلی برای جلوگیری از چسبیدن متن به لبه */
      box-sizing: border-box;
      padding: 16px;
      backdrop-filter: blur(92px);
      /* بدون بلور */
      border-radius: 16px;
      border: #A3BAD3 1px solid;

      z-index: 999;
      opacity: 0;
      display: none;
      /* برای انیمیشن ساده */
      transition: opacity 0.4s ease;

      /* درصورت طولانی بودن محتوا اسکرول می‌خورد */
    }


    nav {
      position: absolute;
      top: -60px;
      left: 0;
      width: 100%;
      background-color: none;
      z-index: 100;
      padding: 8px;
    }

    #topMenuList {
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      list-style: none;
    }

    #topMenuList li a {
      color: black;
      text-decoration: none;
     
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s;
    }

    #topMenuList li a:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: transparent;
      color: #333;
      text-align: center;
      padding: 8px;
      z-index: 100;
    }


    #a {
      position: absolute;
      top: -262px;
      left: -1px;

    }


    button.close-modal {
      background-color: #ff3c00;
      border-radius: 10px;
      width: 50px;
      height: 50px;
      color: white;
      position: absolute;
      right: 10px;
      z-index: 99999;
      top: 50%;
    }

    button.close-modal:hover {
      background-color: #ED4714;
      color: white;
    }

    div {

      display: flex;
      flex-wrap: wrap;
      /* تغییر به flexbox برای چیدمان بهتر */
      /* unicode-bidi: normal; */
      /* حذف تاثیر جداسازی bidi */
    }

    /* کانتینر برای چیدمان گرید */
    .container {
      float: left;
      flex-wrap: wrap;

      flex-flow: column wrap;
      padding: 16px;
      justify-content: center;
      height: 400px;
      justify-content: center;
      overflow: hidden;
      max-width: 960px;
      /* جلوگیری از بزرگ شدن بیش از حد */
      margin: auto;
    }

    /* آیتم‌های داخل گرید */
    .item-wrapper {
      height: 100px;

    }

    /* آیکن‌ها داخل مربع */
    .item {
      background-color: none;
      border-radius: 12px;

    
      max-width: 120px;
      max-height: 120px;
      /* aspect-ratio: 1 / 1; */
      /* مربع */
    }

    /* عکس داخل آیکن */
    .item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
    }

    /* تایتل زیر آیکن */
    .item-title {
      justify-content: center;
 
      font-weight: bold;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
      text-align: center;
      text-align: center;
    }


    .blur-container {
      position: relative;
      width: 350px;
      height: 280px;

    }

    .blurred-background {
      width: 100%;
      height: 100%;
      /* اینجا بلور واقعی اعمال می‌شود */

    }
  </style>
  <style>
  </style>
</head>
<body>
  <!-- you must find pointerdown vs click because in apple device click dont understand -->
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- Three.js imports -->
  <script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/"
  }
}
</script>
  <div id="preloader" style="
  position: fixed;
  inset: 0;
  background-color: #000; /* تمام‌صفحه سیاه */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
">
    <span id="loadingText" style="color: #fff; font-size: 1.2rem;">Loading... 0%</span>
  </div>
  <div id="infoModal">
    <nav>
      <ul id="topMenuList">
        <li><a href="#">Home</a></li>
      </ul>
    </nav>
    <button class="close-modal" onclick="hidePlateModal()">X</button>

    <div id="container">
    </div>
  </div>
  <!-- The 3D canvas -->
  <canvas class="webgl"></canvas>
  <footer>
    <p>© 2025 Zibadis Digital Media Agency</p>
  </footer>
  <script>
    // import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.module.js";
    // import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/controls/OrbitControls.js";
    // import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/GLTFLoader.js";
    const ZibadisHoldingIcon = '3d-model/zibadis-holding.png';
    // آیکن روی بشقاب
    const plateIcons = [
      '3d-model/3dEsite.png',
      '3d-model/Antopeloni.png',
      '3d-model/Zibadis.png',
      '3d-model/ZibadisPlay.png',
      '3d-model/ZinatNet.png',
      '3d-model/AsaieJadoo.png',
      '3d-model/sahfayaft.png',
      '3d-model/yottabyte.png',
    ];
    const sitePaths = [
      '3d-model/site1.html',
      '3d-model/site2.html',
      '3d-model/site3.html',
      '3d-model/site4.html',
      '3d-model/site5.html',
      '3d-model/site6.html',
      '3d-model/site7.html',
      '3d-model/site8.html'
    ];
    // آرایه‌ای از آیکن‌ها (نام و مسیر عکس)
 
    // گرفتن المنت کانتینر
    const container = document.getElementById("container");
    // تولید آیتم‌های آیکن از آرایه
 
    // برای هر بشقاب یک آرایه از آبجکت‌های منو: { label: "عنوان"، link: "#لینک" }
    const plateMenus = [
      //    1-3desite
      [
        {
          inside:
            [
              { name: "Z-Scan", src: "icons/Zibadisplay/z-book.png" },
              { name: "Z-Print", src: "icons/Zibadisplay/z-emergency.png" },
              { name: "Z-Model", src: "icons/Zibadisplay/z-emergency.png" },
              { name: "Z-AR", src: "icons/Zibadisplay/z-emergency.png" },
              
            ]
        },

        { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      //    2-Antopeloni
      [{
        inside:
          [
            { name: "Z-Doctor", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Lab", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Pharma", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Medical", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Emergency ", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Fitness", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Nutrition", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Psychology", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-WomenCare", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Baby", src: "icons/Zibadisplay/z-emergency.png" },
            
           
          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      //  3-Zibadis
      [{
        inside:
          [
            { name: "Z-Graphic", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Motion", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-3D", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Web", src: "icons/Zibadisplay/z-emergency.png" },
          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      //  4-zibadisplay
      [{
        inside:
          [
            { name: "Z-Movie", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Music", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Books", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Games", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Sports", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Books", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Travel", src: "icons/Zibadisplay/z-emergency.png" },
          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      //5-zinat.net
      [{
        inside:
          [
            { name: "Z-Fashion", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Arch", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Jewelry", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Enviro", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Arch", src: "icons/Zibadisplay/z-emergency.png" },
          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      // 6-Asaiejadoo 
      [{
        inside:
          [
            { name: "Z-Bank", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Insurance", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Education", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Transport ", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Energy", src: "icons/Zibadisplay/z-emergency.png" },
           

          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      // 7-shafayaft
      [{
        inside:
          [
            { name: "Z-Meditate", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Focus", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-AntiStress", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Behavior", src: "icons/Zibadisplay/z-emergency.png" },
         

          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
      ],
      //  8-yottabyte
      [{
        inside:
          [
            { name: "Z-Data", src: "icons/Zibadisplay/z-book.png" },
            { name: "Z-Cyber", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-AI", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Cloud", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-IoT", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Block", src: "icons/Zibadisplay/z-emergency.png" },
            { name: "Z-Quantum", src: "icons/Zibadisplay/z-emergency.png" },
          
          ]
      },
      { label: "apps", link: "#p1-1" },
        { label: "blog", link: "#p1-2" },
        { label: "tutorial", link: "#p1-2" },
        { label: "about", link: "#p1-2" },
        { label: "shop", link: "#p1-1" },
        { label: "services", link: "#p1-2" },
        
      ],
    ];
    const loadingManager = new THREE.LoadingManager();
    loadingManager.onStart = function (url, itemsLoaded, itemsTotal) {
      console.log(`شروع لود: ${url}`);
    };
    loadingManager.onProgress = function (url, itemsLoaded, itemsTotal) {
      const progress = Math.floor((itemsLoaded / itemsTotal) * 100);
      document.getElementById('loadingText').textContent = `Loading... ${progress}%`;
    };
    loadingManager.onLoad = function () {
      // وقتی لود تمام شد...
      // اما ما می‌خواهیم حداقل ۱ ثانیه بگذرد
      finishLoading();
    };
    let startTime = 0;
    loadingManager.onStart = function () {
      startTime = performance.now();
    };
    function finishLoading() {
      const elapsed = performance.now() - startTime; // میلی‌ثانیه
      const minimumDuration = 2000; // ۱۰۰۰ میلی‌ثانیه (۱ ثانیه)
      if (elapsed < minimumDuration) {
        const remaining = minimumDuration - elapsed;
        setTimeout(() => {
          fadeOutPreloader();
        }, remaining);
      } else {
        fadeOutPreloader();
      }
    }
    function fadeOutPreloader() {
      gsap.to("#preloader", {
        duration: 0.8,
        opacity: 0,
        ease: "power2.inOut",
        onComplete: () => {
          document.getElementById("preloader").style.display = "none";
        }
      });
    }

    const scene = new THREE.Scene();
    // 1️⃣ ایجاد یک گروه اصلی برای تمام آبجکت‌ها
const mainGroup = new THREE.Group();
scene.add(mainGroup);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 0, 5);
    scene.add(camera);
    const renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.querySelector('canvas.webgl') });
    // دیگر append نکنید، چون خودتان از قبل <canvas> را در صفحه دارید
    renderer.setSize(window.innerWidth, window.innerHeight);
    // renderer.setClearColor(0xff0000, 1);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 0.33;
    renderer.outputEncoding = THREE.sRGBEncoding;
    // scene.background = new THREE.Color( 0xff0000 );
    const sizes = {
      width: window.innerWidth,
      height: window.innerHeight
    }

    document.body.appendChild(renderer.domElement);
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.minPolarAngle = 1.17079;
    controls.maxPolarAngle = 1.17079;
    controls.enableDamping = true;
    controls.enableZoom = false;
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    // other lights
    const pointLight = new THREE.PointLight(0xED4714, 0.6);
    pointLight.position.set(-5, -5, 0);
    scene.add(pointLight);
    pointLight.position.y = 0.1 * Math.sin(Date.now() * 0.002) + 0.2;
    pointLight.rotation.y += 0.005;
    const pointLight2 = new THREE.PointLight(0x1495ED, 0.6);
    pointLight2.position.set(5, 5, 3);
    scene.add(pointLight2);
    pointLight2.position.y = 0.1 * Math.sin(Date.now() * 0.002) + 0.2;
    pointLight2.rotation.y += 0.005;
    const ZibadisHolding = new THREE.Object3D();
    let plates = [];
    const gltfLoader = new THREE.GLTFLoader(loadingManager);
    const textureLoader = new THREE.TextureLoader(loadingManager);
    const cubeTextureLoader = new THREE.CubeTextureLoader()
    const environmentMap = cubeTextureLoader.load([
      '/3d-model/px.png',
      '/3d-model/nx.png',
      '/3d-model/py.png',
      '/3d-model/ny.png',
      '/3d-model/pz.png',
      '/3d-model/nz.png',
    ])
    environmentMap.encoding = THREE.sRGBEncoding
    scene.background = environmentMap
    scene.environment = environmentMap
    // load skill-hat
    gltfLoader.load('3d-model/001.gltf', (gltf) => {
      const material = new THREE.MeshStandardMaterial({ color: 0xa3a3a3, metalness: 0.8, roughness: 0, });
      ZibadisHolding.add(gltf.scene);
      ZibadisHolding.scale.set(5.2, 5.2, 5.2);
      ZibadisHolding.traverse((child) => {
        if (child.isMesh) child.material = material;
      });
      mainGroup.add(ZibadisHolding);
      // scene.add(ZibadisHolding);
      const iconTextureFront = textureLoader.load(ZibadisHoldingIcon);
      const iconMaterialFront = new THREE.MeshBasicMaterial({ map: iconTextureFront, transparent: true });
      const iconGeometry = new THREE.PlaneGeometry(0.2, 0.2);
      const iconMeshFront = new THREE.Mesh(iconGeometry, iconMaterialFront);
      iconMeshFront.position.set(0, 0.2, 0.02);
      ZibadisHolding.add(iconMeshFront);
      // شناوری کلاه
      function floatZibadisHolding() {
        requestAnimationFrame(floatZibadisHolding);
        ZibadisHolding.position.y = 0.1 * Math.sin(Date.now() * 0.002) + 0.2;
        // ZibadisHolding.rotation.y += 0.005;
      }
      floatZibadisHolding();
    });
    // create plates
    function createPlates() {
      const numPlates = 8;
      const radius = 1.5;
      for (let i = 0; i < numPlates; i++) {
        const angle = (i / numPlates) * Math.PI * 2;
        gltfLoader.load('3d-model/001.gltf', (gltf) => {
          // متریال دلخواه
          const material = new THREE.MeshStandardMaterial({
            color: 0xa3a3a3,
            metalness: 0.8,
            roughness: 0
          });
          const plate = gltf.scene;
          plate.scale.set(2, 2, 2);
          plate.position.set(Math.cos(angle) * radius, 0, Math.sin(angle) * radius);
          plate.rotation.x = (Math.PI / 2) + 80;
          plate.traverse((child) => {
            if (child.isMesh) {
              child.material = material;
            }
          });
          // *** به‌جای push ***:
          plates[i] = plate;  // در اندیس i ذخیره کن
          mainGroup.add(plate);
          // آیکن مخصوص این بشقاب
          const iconTex = textureLoader.load(plateIcons[i]); // یا plateIcons[i] 
          const iconMat = new THREE.MeshBasicMaterial({ map: iconTex, transparent: true });
          const iconGeo = new THREE.PlaneGeometry(0.2, 0.2);
          const iconMesh = new THREE.Mesh(iconGeo, iconMat);
          iconMesh.position.set(0, 0.15, 0.02);
          plate.add(iconMesh);
        });
      }
    }
    createPlates();
    function showPlateContent(i) {
      // گرفتن فایل HTML مربوط به این بشقاب
      const filePath = sitePaths[i];
      // لود فایل با fetch
      fetch(filePath)
        .then(resp => resp.text())
        .then(htmlData => {
          // قرار دادن محتوای فایل در div (مثلاً #modalContentArea)
          document.getElementById('modalContentArea').innerHTML = htmlData;
          // نمایش مودال با انیمیشن
          const infoModal = document.getElementById('infoModal');
          infoModal.classList.add('show');
          // می‌توانیم اگر خواستیم منو را هم تغییر دهیم
          // updatePlateMenu(i); ...
        });
    }
    // وقتی روی بشقاب i کلیک شود:
    function loadHTMLinDiv(i) {
      fetch(sitePaths[i])
        .then(resp => resp.text())
        .then(htmlData => {
          document.getElementById('siteContainer').innerHTML = htmlData;
          document.getElementById('siteContainer').style.display = 'block';
        });
    }
    function updatePlateMenu(plateIndex) {
      const navList = document.getElementById("topMenuList");
      // پاک کردن آیتم‌های قبلی
      navList.innerHTML = "";
      container.innerHTML = "";
      // const structuredData = plateMenus.map((plate) => {
      //   return plate.map((item) => {
      //     if (item.inside) {
      //       return item.inside.map(icon => `Icon: ${icon.name} (${icon.src})`);
      //     } else {
      //       return `Menu: ${item.label} -> ${item.link}`;
      //     }
      //   });
      // });
      // console.log(structuredData);
      // گرفتن آیتم‌های منوی این بشقاب
      const currentMenu = plateMenus[plateIndex] || [];
      // افزودن آیتم‌های جدید
      currentMenu.forEach(item => {
        if (item.inside) {
          item.inside.forEach(icon => {
            const wrapper = document.createElement("div");
            wrapper.classList.add("item-wrapper");
            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");
            const img = document.createElement("img");
            img.src = icon.src;
            img.alt = icon.name;
            const title = document.createElement("div");
            title.classList.add("item-title");
            title.textContent = icon.name;
            itemDiv.appendChild(img);
            wrapper.appendChild(itemDiv);
            wrapper.appendChild(title);
            container.appendChild(wrapper);
          });
        }
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.textContent = item.label; // برچسب
        a.href = item.link;         // لینک
        li.appendChild(a);
        navList.appendChild(li);
      });
      waveInMenuItems();
    }
    const modal = document.getElementById('infoModal');
    // متغیرهای state
// متغیرهای state
let isModalOpen = false; // وضعیت باز یا بسته بودن مودال
let originalGroupY = 0;  // موقعیت اولیه mainGroup

// تابع برای حرکت گروه به پایین
function moveGroupDown(distance) {
  const modal = document.getElementById("infoModal");

  // بررسی باز بودن مودال
  if ( isModalOpen) {
    originalGroupY = mainGroup.position.y; // ذخیره موقعیت فعلی
    gsap.to(mainGroup.position, {
      y: mainGroup.position.y - distance,
      duration: 1,
      ease: "power2.inOut"
    });
  }
}
// 6️⃣ تست جابه‌جایی گروه با کل آبجکت‌ها
// setTimeout(() => {
//   moveGroupDown(2); // جابه‌جایی کل گروه به پایین
// }, 3000);
    window.addEventListener('pointerdown', (event) => {
      event.preventDefault();
      const mouse = new THREE.Vector2(
        (event.clientX / window.innerWidth) * 2 - 1,
        -(event.clientY / window.innerHeight) * 2 + 1
      );
      const raycaster = new THREE.Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(plates, true);
      if (intersects.length > 0) {
        const clickedPlateIndex = plates.indexOf(intersects[0].object.parent);
        if (clickedPlateIndex !== -1) {
          // نمایش مودال
          showPlateModal(clickedPlateIndex);
          // مثلاً اگر بخواهی بشقاب ها رو انیمیت کنی, گوی رو جا به جا کنی, ...
          moveGroupDown(2);
          
          
      
          //zibadisholding
          //plates
          // gsap.to(plates.position,{ y:-2, duration:1 });
        }
      }
    });

// تابع برای نمایش مودال
function showPlateModal(index) {
  const modal = document.getElementById('infoModal');
  isModalOpen = true; // مودال باز است

  modal.style.display = 'flex';
  gsap.to(modal, {
    duration: 0.5,
    opacity: 1,
    scale: 1,
    ease: "back.out(1.7)"
  });

  updatePlateMenu(index);
}
    function resetMenuToHome() {
      const navList = document.getElementById("topMenuList");
      navList.innerHTML = "";
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.textContent = "Home";
      a.href = "#";
      li.appendChild(a);
      navList.appendChild(li);
    }
    // تابع برای بستن مودال و بازگرداندن گروه به موقعیت اصلی
function hidePlateModal() {
  const modal = document.getElementById('infoModal');
  isModalOpen = false; // مودال بسته می‌شود

  gsap.to(modal, {
    duration: 0.4,
    opacity: 0,
    scale: 0.7,
    ease: "power2.inOut",
    onComplete: () => {
      modal.style.display = 'none';

      // بازگرداندن گروه به موقعیت اولیه
      gsap.to(mainGroup.position, {
        y: originalGroupY,
        duration: 1,
        ease: "power2.inOut"
      });

      resetMenuToHome();
      waveInMenuItems();
    }
  });
}
    // window.hidePlateModal = function () {
      
    //   restoreObjects(-2); // Restore original positions
    //   // اول خود مودال بسته شود
    //   gsap.to(modal, {
    //     duration: 0.4,
    //     opacity: 0,
    //     scale: 0.7,
    //     ease: "power2.inOut",
    //     onComplete: () => {
    //       modal.style.display = 'none';
          
    //       // حالا منوی فعلی را با انیمیشن خارج کنیم
    //       waveOutMenuItems(() => {
    //         // وقتی منو کامل خارج شد، به Home برگرد
    //         resetMenuToHome();
            
    //         // حالا Home را با انیمیشن وارد کن
    //         waveInMenuItems();
    //       });
    //     }
    //   });
    // }
    
    function waveInMenuItems() {
      // تمام liهای منو را می‌گیریم
      const liItems = document.querySelectorAll("#topMenuList li");
      liItems.forEach((li, i) => {
        gsap.from(li, {
          duration: 0.5,
          y: -10,      // از کمی بالاتر
          opacity: 0,
          ease: "power4.inOut",
          delay: i * 0.2
        });
      });
    }
    function waveOutMenuItems(onComplete) {
      const liItems = document.querySelectorAll("#topMenuList li");
      if (!liItems.length) {
        // اگر چیزی برای خروج وجود ندارد، مستقیم تابع بعدی را صدا بزن
        onComplete && onComplete();
        return;
      }
      gsap.to(liItems, {
        duration: 0.5,
        y: 10,       // پایین برود
        opacity: 0,
        ease: "power4.inOut",
        // فاصله زمانی بین آیتم‌ها
        stagger: 0.2,
        onComplete: () => {
          // بعد از پایان انیمیشن خروج
          onComplete && onComplete();
        }
      });
    }
    function animate() {
      requestAnimationFrame(animate);
      plates.forEach((plate, index) => {
        // چرخش یا شناوری plate ها
        plate.position.y = Math.sin(Date.now() * 0.002 + index) * 0.1;
        // همچنین آیکونش رو به دوربین نگاه بده
        plate.children.forEach(child => {
          if (child.isMesh && child.geometry.type === 'PlaneGeometry') {
            const lookAtY = camera.position.clone();
            lookAtY.y = child.position.y;
            child.lookAt(lookAtY);
          }
        });
      });
      // چرخش یا شناوری plate ها
      // همچنین آیکونش رو به دوربین نگاه بده
      const lookAtY = camera.position.clone();
      lookAtY.y = ZibadisHolding.position.y;
      ZibadisHolding.lookAt(lookAtY);
      controls.update();
      renderer.render(scene, camera);

    }
    animate();
    // ریسپانسیو
    window.addEventListener('resize', () => {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    });
  </script>

</body>

</html>
